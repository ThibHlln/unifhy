

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Development &mdash; cm4twc latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://cm4twc-org.github.io/cm4twc/contributors/development.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Packaging" href="packaging.html" />
    <link rel="prev" title="Guide for Contributors" href="../contributors.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo_colours.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../users.html">Guide for Users</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/tutorial.html">Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/tutorial.html#configuring-a-model">Configuring a Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../users/tutorial.html#time">Time</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/tutorial.html#space">Space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/tutorial.html#data">Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/tutorial.html#science">Science</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/tutorial.html#framework">Framework</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../users/tutorial.html#simulating-with-a-model">Simulating with a Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../users/tutorial.html#spin-up-and-simulate">Spin-Up and Simulate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/tutorial.html#resume">Resume</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/files.html">Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/files.html#model-configuration-file">Model Configuration File</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../contributors.html">Guide for Contributors</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-your-component-by-subclassing-a-generic-framework-component">Create your component by subclassing a generic framework component</a></li>
<li class="toctree-l3"><a class="reference internal" href="#document-your-component-using-its-class-docstring">Document your component using its class docstring</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-your-component-using-its-class-attributes">Define your component using its class attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implement-the-initialise-run-finalise-component-class-methods">Implement the initialise-run-finalise component class methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="packaging.html">Packaging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="packaging.html#create-a-local-git-repository">Create a local git repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="packaging.html#retrieve-the-component-package-template">Retrieve the component package template</a></li>
<li class="toctree-l3"><a class="reference internal" href="packaging.html#bring-in-your-component-contribution-s">Bring in your component contribution(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="packaging.html#populate-the-package-metadata">Populate the package metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sharing.html">Sharing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sharing.html#push-your-contribution-to-the-cm4twc-github-organisation">Push your contribution to the cm4twc GitHub organisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="sharing.html#upload-your-contribution-to-the-python-package-index">Upload your contribution to the Python Package Index</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">Guide for Developers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../science_repository.html">Science Repository</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../science/surfacelayer.html">Surface Layer Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../science/surfacelayer/cm4twccontrib.artemis.SurfaceLayerComponent.html">cm4twccontrib.artemis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../science/subsurface.html">Sub-Surface Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../science/subsurface/cm4twccontrib.artemis.SubSurfaceComponent.html">cm4twccontrib.artemis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../science/openwater.html">Open Water Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../science/openwater/cm4twccontrib.rfm.OpenWaterComponent.html">cm4twccontrib.rfm</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference.html#model">Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.Model.html">Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.Model.html#methods">Methods</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference.html#components">Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.SurfaceLayerComponent.html">SurfaceLayerComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.SubSurfaceComponent.html">SubSurfaceComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.OpenWaterComponent.html">OpenWaterComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.DataComponent.html">DataComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.NullComponent.html">NullComponent</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference.html#time">Time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.TimeDomain.html">TimeDomain</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.TimeDomain.html#methods">Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.TimeDomain.html#attributes">Attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference.html#space">Space</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.LatLonGrid.html">LatLonGrid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.LatLonGrid.html#methods">Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.LatLonGrid.html#attributes">Attributes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.RotatedLatLonGrid.html">RotatedLatLonGrid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.RotatedLatLonGrid.html#methods">Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.RotatedLatLonGrid.html#attributes">Attributes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.BritishNationalGrid.html">BritishNationalGrid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.BritishNationalGrid.html#methods">Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.BritishNationalGrid.html#attributes">Attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference.html#data">Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/classes/cm4twc.DataSet.html">DataSet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/cm4twc.DataSet.html#methods">Methods</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#latest">latest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-1-0-beta">v0.1.0-beta</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../licence.html">Licence</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cm4twc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../contributors.html">Guide for Contributors</a> &raquo;</li>
        
      <li>Development</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<p>This section details the steps required to develop a component contribution
that is compliant with the framework.</p>
<p>You can follow the steps below to develop your component(s):</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#create-your-component-by-subclassing-a-generic-framework-component" id="id6">Create your component by subclassing a generic framework component</a></p></li>
<li><p><a class="reference internal" href="#document-your-component-using-its-class-docstring" id="id7">Document your component using its class docstring</a></p></li>
<li><p><a class="reference internal" href="#define-your-component-using-its-class-attributes" id="id8">Define your component using its class attributes</a></p></li>
<li><p><a class="reference internal" href="#implement-the-initialise-run-finalise-component-class-methods" id="id9">Implement the initialise-run-finalise component class methods</a></p></li>
</ul>
</div>
<div class="section" id="create-your-component-by-subclassing-a-generic-framework-component">
<h2>Create your component by subclassing a generic framework component<a class="headerlink" href="#create-your-component-by-subclassing-a-generic-framework-component" title="Permalink to this headline">¶</a></h2>
<p>In the modelling framework, the terrestrial water cycle is divided into
three components, i.e. <a class="reference internal" href="../api/classes/cm4twc.SurfaceLayerComponent.html#cm4twc.SurfaceLayerComponent" title="cm4twc.SurfaceLayerComponent"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SurfaceLayerComponent</span></code></a>, <a class="reference internal" href="../api/classes/cm4twc.SubSurfaceComponent.html#cm4twc.SubSurfaceComponent" title="cm4twc.SubSurfaceComponent"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SubSurfaceComponent</span></code></a>,
and <a class="reference internal" href="../api/classes/cm4twc.OpenWaterComponent.html#cm4twc.OpenWaterComponent" title="cm4twc.OpenWaterComponent"><code class="xref py py-obj docutils literal notranslate"><span class="pre">OpenWaterComponent</span></code></a> (see <a class="reference internal" href="../index.html#fig-diagram"><span class="std std-ref">Fig. 1</span></a>). These are the
three framework components to create subclasses from.</p>
<p>Each component features a fixed interface (i.e. a pre-defined set of
transfers of information with the other components of the framework):
inward information (variables that are given to the component), and
outward information (variables that are computed by the component),
see <a class="reference internal" href="#fig-transfers"><span class="std std-ref">Fig. 2</span></a>.</p>
<div class="figure align-center" id="id1">
<span id="fig-transfers"></span><a class="reference internal image-reference" href="../_images/framework_detailed_transfers.png"><img alt="component transfers" src="../_images/framework_detailed_transfers.png" style="width: 634.8px; height: 458.4px;" /></a>
<p class="caption"><span class="caption-text">Fig. 2: Transfers of Information between Components.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>For component contributions to be <code class="xref py py-obj docutils literal notranslate"><span class="pre">cm4twc</span></code>-compliant, they need to comply
with this fixed interface. If your component contribution is overlapping
several components, it requires to be refactored into the relevant number
of components.</p>
<p>Contributions must be implemented as Python classes, and more specifically
as subclasses of one of the three framework components. This way, the
interface for the component contribution is already set, and the
component directly inherits all the functionalities intrinsic to the
framework so that, as a contributor, you can focus solely on specifying
the data and science elements of your component(s).</p>
<p>Creating your contribution as a Python class can simply be done by
subclassing from the relevant framework component, e.g. a surface layer
component would be created as follows:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Subclassing from <a class="reference internal" href="../api/classes/cm4twc.SurfaceLayerComponent.html#cm4twc.SurfaceLayerComponent" title="cm4twc.SurfaceLayerComponent"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SurfaceLayerComponent</span></code></a> class.</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cm4twc</span>


<span class="k">class</span> <span class="nc">SurfaceLayerComponent</span><span class="p">(</span><span class="n">cm4twc</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">SurfaceLayerComponent</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="code highlight python docutils literal notranslate"><span class="k"><span class="pre">pass</span></span></code> is only added here temporarily for this Python example
script to remain valid, it will be replaced in the subsequent steps.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By convention, it is asked that you use the same class name as the
one you subclassed from, e.g. <em>SurfaceLayerComponent</em> here.</p>
</div>
</div>
<div class="section" id="document-your-component-using-its-class-docstring">
<h2>Document your component using its class docstring<a class="headerlink" href="#document-your-component-using-its-class-docstring" title="Permalink to this headline">¶</a></h2>
<p>A brief description of the component (with reference(s) if applicable)
alongside a field list containing e.g. name(s) of contributor(s),
affiliation(s) of contributor(s), licence, copyright, etc. must be provided.
To do so, use your class docstring and follow a <a class="reference external" href="https://docutils.sourceforge.io/docs/user/rst/quickref.html">reStructuredText syntax</a> as
in the example below.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Using the component class docstring for description and acknowledgment.</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cm4twc</span>


<span class="k">class</span> <span class="nc">SurfaceLayerComponent</span><span class="p">(</span><span class="n">cm4twc</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">SurfaceLayerComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Brief description of the component.</span>

<span class="sd">    Details published in `Doe et al. (2020) &lt;https://doi.org/##.####/XXX&gt;`_.</span>

<span class="sd">    :Contributors: Jane Doe [1]</span>
<span class="sd">    :Affiliations: [1] University</span>
<span class="sd">    :Licence: GPL-3.0</span>
<span class="sd">    :Copyright: 2021, Jane Doe</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="define-your-component-using-its-class-attributes">
<h2>Define your component using its class attributes<a class="headerlink" href="#define-your-component-using-its-class-attributes" title="Permalink to this headline">¶</a></h2>
<p>The component definition is used by <code class="xref py py-obj docutils literal notranslate"><span class="pre">cm4twc</span></code> to make sure that all the
information required by the component to run is provided by the user.
The definition of a component is made of the information about its
inputs, outputs, states, parameters, and constants.</p>
<p>The inputs/outputs exclude those variables already included in the fixed
interface, i.e. inward and outward transfers (see <a class="reference internal" href="#fig-transfers"><span class="std std-ref">Fig. 2</span></a>).</p>
<p>The inputs must be one of three following kinds:</p>
<ul class="simple">
<li><p>dynamic: data required for each spatial element and for each time step,</p></li>
<li><p>static: data required for each spatial element and constant over time,</p></li>
<li><p>climatologic: data required for each spatial element and for a given
frequency within a climatology year.</p></li>
</ul>
<p>The parameters are those subject to tuning, while the constants are those
not subject to tuning. Note, parameter tuning/calibration is not a
functionality offered by the framework.</p>
<p>The definition for the component is specified by assigning dictionaries
to the class attributes <code class="xref py py-obj docutils literal notranslate"><span class="pre">_inputs_info</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">_outputs_info</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">_states_info</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">_parameters_info</span></code>, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">_constants_info</span></code>. For example, in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">_inputs_info</span></code>
dictionary, each item corresponds to a different input, and for this item
the key is the name of the input, and the value is a dictionary containing
the metadata for the input, featuring at least two items, one for its <em>kind</em>
and one for its <em>units</em> (and one for its <em>frequency</em> if <em>kind</em> is
<em>climatologic</em>). All other items in the component definition must feature
at least a <em>units</em> metadata item, and an optional <em>description</em> metadata
item is strongly encouraged. An additional item <em>default_value</em> is
mandatory for each constant in <code class="xref py py-obj docutils literal notranslate"><span class="pre">_constants_info</span></code>.</p>
<p>An optional <em>divisions</em> item exists for the <code class="xref py py-obj docutils literal notranslate"><span class="pre">_states_info</span></code> dictionary,
where its expected value is an integer, a string, or a sequence of integers
and/or strings:</p>
<ul class="simple">
<li><p>by default its value is 1, indicating the state is a scalar;</p></li>
<li><p>if its value is an integer greater than 1, it indicates that the state
is a vector, and its value is the length of the vector;</p></li>
<li><p>if its value is a string, the string must correspond to the name of a
component constant, whose value will be used in place of the string
as divisions;</p></li>
<li><p>if its value is a sequence, it indicates that the state is an array,
and its values are the length of the dimensions of the array (in the
order in the sequence).</p></li>
</ul>
<p>The <em>divisions</em> item may be useful when considering e.g. different
vertical layers in a component. Note that scalar/vector/array refer to
the dimension of the state for a given element in the SpaceDomain, so
a scalar state does not mean that there is only one state value for the
whole spatial domain, it only means that there is only one state value for
each spatial element in the space domain.</p>
<p>In addition, the component definition features two special optional
attributes <code class="xref py py-obj docutils literal notranslate"><span class="pre">_requires_land_sea_mask</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">_requires_flow_direction</span></code>.
They must be assigned a boolean value (True if required by your
component, False if not) – their default value is False. If you need
land sea mask information for your computations, set <code class="xref py py-obj docutils literal notranslate"><span class="pre">_requires_land_sea_mask</span></code>
to True and access it in your class methods using
<code class="xref py py-obj docutils literal notranslate"><span class="pre">self.spacedomain.land_sea_mask</span></code>. If you need flow direction information
or want to use the flow routing functionality of the component (accessible
through <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.spacedomain.route(...)</span></code>), set <code class="xref py py-obj docutils literal notranslate"><span class="pre">_requires_flow_direction</span></code> to True,
and access it in your class methods using <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.spacedomain.flow_direction</span></code>.</p>
<p>See a detailed example of a mock component definition below.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Completing the component class definition in the class attributes.</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cm4twc</span>


<span class="k">class</span> <span class="nc">SurfaceLayerComponent</span><span class="p">(</span><span class="n">cm4twc</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">SurfaceLayerComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;component description here&quot;&quot;&quot;</span>

    <span class="n">_inputs_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;input_1&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="s1">&#39;dynamic&#39;</span><span class="p">,</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 s-1&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;input_2&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="s1">&#39;climatologic&#39;</span><span class="p">,</span>
            <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="s1">&#39;monthly&#39;</span><span class="p">,</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 s-1&#39;&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;input_3&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="s1">&#39;static&#39;</span><span class="p">,</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">_outputs_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;output_1&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2 s-1&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;output_2&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-3 s-1&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">_states_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;state_1&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;state_2&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;divisions&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg m-2&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">_parameters_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;parameter_1&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;brief parameter description here&#39;</span><span class="p">,</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">_constants_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;constant_1&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;brief constant description here&#39;</span><span class="p">,</span>
            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;default_value&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">_requires_land_sea_mask</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_requires_flow_direction</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="implement-the-initialise-run-finalise-component-class-methods">
<h2>Implement the initialise-run-finalise component class methods<a class="headerlink" href="#implement-the-initialise-run-finalise-component-class-methods" title="Permalink to this headline">¶</a></h2>
<p>The computations in your component contribution must be broken down into
the three phases initialise, run, and finalise. This means that your
Python class must feature three methods named <code class="xref py py-obj docutils literal notranslate"><span class="pre">initialise</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code>, and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">finalise</span></code>. Note, <code class="xref py py-obj docutils literal notranslate"><span class="pre">initialize</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">finalize</span></code> spellings are not supported.</p>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">initialise</span></code> method defines the initial conditions for the component
states and features any other action required to enable the component to
start its integration. It is called at the beginning of a model simulation.
The available arguments for this method are the component states, parameters,
and constants. This method is not expected to return anything (i.e.
Python default’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">return</span> <span class="pre">None</span></code>).</p>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code> method contains the computations required to integrate from
one time step to the next. It is called iteratively to move through the
model simulation period. The available arguments for this method are the
component inwards, inputs, states, parameters, and constants. This method
is expected to return a tuple of two dictionaries: the first dictionary
must contain the component outward transfers (keys are the outwards names,
values are the outwards arrays), the second dictionary must contain the
component outputs (keys are the outputs names, values are the outputs
arrays). Note, the second dictionary may be empty if the component does
not feature any custom outputs.</p>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">finalise</span></code> method contains any action required to guarantee that the
simulation can be restarted after the last simulation time step. It is
called once at the end of a model simulation. The available arguments
for this method are the component states, parameters, and constants.
This method is not expected to return anything (i.e. Python default’s
<code class="xref py py-obj docutils literal notranslate"><span class="pre">return</span> <span class="pre">None</span></code>).</p>
<p>Since, the arguments of the three methods <code class="xref py py-obj docutils literal notranslate"><span class="pre">initialise</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code>, and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">finalise</span></code> are going to be passed as keyword arguments, the names of the
arguments in these methods’ signatures must necessarily be the ones found
in the component class attributes (if renaming is required, this must be
done internally to the methods). Moreover, they must all feature a final
special argument <code class="xref py py-obj docutils literal notranslate"><span class="pre">**kwargs</span></code> to collect all the remaining available
arguments that are not used.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Implementing the three mandatory methods initialise, run, and finalise.</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cm4twc</span>


<span class="k">class</span> <span class="nc">SurfaceLayerComponent</span><span class="p">(</span><span class="n">cm4twc</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">SurfaceLayerComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;component description here&quot;&quot;&quot;</span>

    <span class="c1"># component definition here</span>

    <span class="k">def</span> <span class="nf">initialise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_1</span><span class="p">,</span> <span class="n">state_2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># set here initial condition values for component states</span>
        <span class="n">state_1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">state_2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inwards_1</span><span class="p">,</span> <span class="n">inwards_2</span><span class="p">,</span> <span class="n">inwards_3</span><span class="p">,</span> <span class="n">input_1</span><span class="p">,</span> <span class="n">input_2</span><span class="p">,</span> <span class="n">input_3</span><span class="p">,</span>
            <span class="n">state_1</span><span class="p">,</span> <span class="n">state_2</span><span class="p">,</span> <span class="n">parameter_1</span><span class="p">,</span> <span class="n">constant_1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># compute science using available inwards/inputs/parameters/constants</span>
        <span class="n">routed</span><span class="p">,</span> <span class="n">outed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacedomain</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">inwards_1</span> <span class="o">+</span> <span class="n">inwards_2</span> <span class="o">+</span> <span class="n">inwards_3</span><span class="p">)</span>

        <span class="n">outwards_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">routed</span> <span class="o">+</span> <span class="n">input_1</span> <span class="o">+</span> <span class="n">state_1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                      <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta_in_seconds</span><span class="p">)</span> <span class="o">*</span> <span class="n">parameter_1</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_datetime</span><span class="o">.</span><span class="n">month</span>

        <span class="n">output_1</span> <span class="o">=</span> <span class="n">input_2</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*</span> <span class="n">constant_1</span>

        <span class="n">output_2</span> <span class="o">=</span> <span class="n">input_2</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">constant_1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">output_2</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">state_2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                         <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta_in_seconds</span><span class="p">)</span>
        <span class="n">output_2</span> <span class="o">/=</span> <span class="n">input_3</span>

        <span class="c1"># update component state</span>
        <span class="n">state_1</span><span class="p">[</span><span class="mi">0</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">state_1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta_in_seconds</span> <span class="o">*</span> <span class="n">parameter_1</span><span class="p">)</span>
        <span class="n">state_2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.95</span> <span class="o">*</span> <span class="n">state_2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">...</span><span class="p">]</span>

        <span class="c1"># return outwards and outputs</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;outwards_1&#39;</span><span class="p">:</span> <span class="n">outwards_1</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;output_1&#39;</span><span class="p">:</span> <span class="n">output_1</span><span class="p">,</span>
             <span class="s1">&#39;output_2&#39;</span><span class="p">:</span> <span class="n">output_2</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">finalise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_1</span><span class="p">,</span> <span class="n">state_2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># cleanly wrap up simulation here</span>
        <span class="c1"># to be able to restart from where simulation stopped</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<p>This concludes the preparation of your component contribution, the next
step is to <a class="reference internal" href="packaging.html"><span class="doc">package</span></a> your component(s).</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-2021, UK Centre for Ecology &amp; Hydrology.
      <span class="lastupdated">
        Last updated on Sep 16, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
<span class="rst-current-version" data-toggle="rst-current-version">
  <div style="float:left;">
    <span class="fa fa-bars"> </span>
  </div>
  <div style="float:right;">
    v: latest
    <span class="fa fa-caret-down"></span>
  </div>
</span>
<div class="rst-other-versions">
  
  <dl>
    <dt>Versions</dt>
    
      <dd><a href="https://cm4twc-org.github.io/cm4twc">latest</a></dd>
    
      <dd><a href="https://cm4twc-org.github.io/cm4twc/0.1.0-beta">v0.1.0-beta</a></dd>
    
  </dl>
  
  <dl>
    <dt>External Resources</dt>
    
      <dd><a href="https://github.com/cm4twc-org/cm4twc.git">Source Code</a></dd>
    
      <dd><a href="https://github.com/cm4twc-org/cm4twc/issues">Issue Tracker</a></dd>
    
      <dd><a href="https://github.com/cm4twc-org/cm4twc/discussions">User Support</a></dd>
    
  </dl>
  
</div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>